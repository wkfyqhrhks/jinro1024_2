<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì§„ë¡œ ê´€ì‹¬ì‚¬ ì„¤ë¬¸ì¡°ì‚¬</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  :root{
    --bg1:#6a75ff; --bg2:#ff5fb3;
    --ink:#0f172a; --muted:#64748b; --card:#ffffff; --soft:#f1f5f9;
    --brand:#7c3aed; --brand-2:#ec4899; --ok:#10b981; --warn:#f59e0b;
    --ring: 0 10px 30px rgba(124, 58, 237,.18);
    --ring-2: 0 10px 30px rgba(236, 72, 153,.18);
    --w: 960px; --pad: clamp(16px, 2.8vw, 28px); --radius: 18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Pretendard,system-ui,apple system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    color:var(--ink); background: linear-gradient(135deg,var(--bg1),var(--bg2)) fixed;
  }
  .wrap{min-height:100%; display:flex; align-items:flex-start; justify-content:center; padding: min(8vh,60px) 14px;}
  .container{ width:min(100%,var(--w)); margin:auto; }
  .panel{
    background:var(--card); border-radius: calc(var(--radius) + 6px);
    box-shadow: 0 2px 0 rgba(255,255,255,.4) inset, 0 1px 0 rgba(0,0,0,.05);
    padding: clamp(18px, 3.4vw, 36px);
  }
  .glass{ background:linear-gradient(180deg,rgba(255,255,255,.92),rgba(255,255,255,.86)); backdrop-filter:blur(6px); }
  .title{font-weight:800; letter-spacing:-.02em; margin:0 0 4px; font-size:clamp(26px,4.2vw,44px)}
  .sub{color:var(--muted); margin:0 0 18px; font-size:clamp(14px,1.9vw,18px)}
  .badge{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; font-weight:700; background:linear-gradient(90deg,#f5f3ff,#fdf4ff); border-radius:999px; border:1px solid #ede9fe; color:#6d28d9; font-size:13px}
  .note{background:linear-gradient(180deg,#f8fafc,#f1f5f9); border:1px solid #e2e8f0; border-radius:16px; padding:16px 18px; color:#0f172a}
  .note ul{margin:10px 0 0 18px; padding:0}
  .note li{margin:8px 0}
  .btn{
    cursor:pointer; user-select:none; border:0; outline:0;
    display:inline-flex; align-items:center; justify-content:center; gap:.55rem;
    height:54px; padding:0 22px; font-weight:800; font-size:16px; letter-spacing:-.02em;
    color:#fff; border-radius:999px; box-shadow: var(--ring), var(--ring-2);
    background-image: linear-gradient(90deg,var(--brand), var(--brand-2));
    transition: transform .08s ease, filter .2s ease;
  }
  .btn:active{transform: translateY(1px)}
  .btn[disabled]{opacity:.45; cursor:not-allowed; box-shadow:none}
  .center{display:flex; justify-content:center; align-items:center}
  .spc{height:18px}
  .progress{height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden}
  .progress > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--brand),var(--brand-2)); transition:width .25s}
  .q-emoji{font-size:40px; margin-bottom:6px}
  .chip{display:inline-block; padding:6px 10px; font-weight:700; border-radius:999px; font-size:12px; color:#fff}
  .chip.R{background:#3b82f6} .chip.I{background:#8b5cf6} .chip.A{background:#ec4899}
  .chip.S{background:#22c55e} .chip.E{background:#f59e0b} .chip.C{background:#14b8a6}
  .choice{
    width:100%; border:1px solid #e5e7eb; border-radius:14px; padding:14px 16px; background:#f8fafc;
    display:flex; align-items:center; justify-content:space-between; font-weight:700;
    transition: transform .05s ease, background .15s, border .15s;
  }
  .choice + .choice{margin-top:10px}
  .choice:hover{background:#f1f5f9}
  .choice.active{background:linear-gradient(90deg,#7c3aed,#ec4899); color:#fff; border-color:transparent; transform:translateY(-1px)}
  .footer-actions{display:flex; justify-content:space-between; gap:10px; margin-top:14px}
  .ghost{height:46px; padding:0 18px; border-radius:999px; border:1px solid #e5e7eb; background:#fff; color:#334155; font-weight:700}
  .ghost[disabled]{opacity:.4; cursor:not-allowed}

  /* ê²°ê³¼ ì¹´ë“œ */
  .result-head{display:flex; align-items:center; gap:12px; margin-bottom:10px}
  .medals{display:flex; gap:14px; justify-content:center; margin:10px 0 18px}
  .medal{
    width:70px; aspect-ratio:1/1.05; border-radius:18px; display:flex; flex-direction:column; align-items:center; justify-content:center;
    color:#fff; font-weight:900; box-shadow:0 8px 16px rgba(0,0,0,.07);
  }
  .medal small{font-size:11px; opacity:.95; margin-top:4px}
  .bar{height:12px; background:#e2e8f0; border-radius:999px; overflow:hidden}
  .bar i{display:block; height:100%}
  .grid{display:grid; gap:14px}
  @media (min-width: 840px){ .grid.cols-2{grid-template-columns: 1fr 1fr} }
  .card{background:var(--soft); border:1px solid #e5e7eb; border-radius:16px; padding:16px}
  .jobs{display:grid; gap:10px}
  @media (min-width:740px){ .jobs{grid-template-columns: 1fr 1fr} }
  .job{background:#fff; border:1px solid #eef2f7; border-radius:12px; padding:12px 14px; display:flex; align-items:center; gap:10px}
  .score-row{display:grid; grid-template-columns: 110px 1fr 48px; gap:10px; align-items:center}
  .score-name{font-weight:700; color:#334155}
  .road ul{margin:8px 0 0 16px}
  .road li{margin:8px 0}
  .muted{color:#64748b; font-size:12px}
  .hidden{display:none !important}

  #captureArea{position:relative}
</style>
</head>
<body>
<div class="wrap">
  <main class="container">

    <!-- ===== Intro ===== -->
    <section id="intro" class="panel glass">
      <div class="result-head"><span class="badge">âœ¨ ì§„ë¡œ ê´€ì‹¬ì‚¬ ì„¤ë¬¸ì¡°ì‚¬</span></div>
      <h1 class="title">ë‹¹ì‹ ì˜ ë¯¸ë˜ë¥¼ ìœ„í•œ ì²« ê±¸ìŒ</h1>
      <p class="sub">ì´ 36ê°œ ë¬¸í•­ì— ë‹µí•˜ê³  ë‚˜ì˜ RIASEC í¥ë¯¸ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>

      <div class="note">
        <strong>ğŸ“ ì„¤ë¬¸ ì•ˆë‚´</strong>
        <ul>
          <li>ì´ <b>36ê°œ</b> ë¬¸í•­ì— ë‹µë³€í•´ì£¼ì„¸ìš”.</li>
          <li>ê° ë¬¸í•­ì€ <b>1~5ì </b> (ì „í˜€ ì•„ë‹˜ â†’ ë§¤ìš° ê·¸ëŸ¼) ìœ¼ë¡œ í‰ê°€í•©ë‹ˆë‹¤.</li>
          <li>ì†”ì§í•œ ë‹µë³€ì´ ê°€ì¥ ì •í™•í•œ ê²°ê³¼ë¥¼ ë§Œë“­ë‹ˆë‹¤.</li>
        </ul>
      </div>

      <div class="spc"></div>
      <div class="center">
        <button id="startBtn" class="btn" type="button" aria-label="ì„¤ë¬¸ ì‹œì‘í•˜ê¸°">ì„¤ë¬¸ ì‹œì‘í•˜ê¸° â†’</button>
      </div>
    </section>

    <!-- ===== Survey ===== -->
    <section id="survey" class="panel hidden" aria-live="polite">
      <div class="progress" aria-hidden="true"><i id="pgFill"></i></div>
      <div class="spc"></div>

      <div class="center"><span id="qType" class="chip">I</span></div>
      <div class="center"><div id="qEmoji" class="q-emoji">ğŸ¤–</div></div>
      <h2 id="qText" class="title" style="text-align:center; font-size:clamp(18px,3.2vw,28px)"></h2>
      <p id="qRole" class="sub" style="text-align:center"></p>

      <div id="choices"></div>

      <div class="footer-actions">
        <button id="prev" class="ghost" type="button">â† ì´ì „</button>
        <button id="next" class="btn" type="button" disabled>ë‹¤ìŒ â†’</button>
      </div>
    </section>

    <!-- ===== Result ===== -->
    <section id="result" class="panel hidden">
      <div id="captureArea">
        <div class="result-head"><span class="badge">ğŸ† ê²€ì‚¬ ì™„ë£Œ</span></div>
        <h2 class="title" style="margin:0 0 6px">ë‹¹ì‹ ë§Œì˜ í¥ë¯¸ ì½”ë“œë¥¼ ë°œê²¬í–ˆì–´ìš”!</h2>
        <p class="sub">ì•„ë˜ ì´ë¯¸ì§€ë¥¼ JPEGë¡œ ì €ì¥í•˜ì—¬ ê°€ì ¸ê°ˆ ìˆ˜ ìˆì–´ìš”.</p>

        <!-- Top3 -->
        <div class="card">
          <h3 style="margin:0 0 8px">ë‚˜ì˜ í¥ë¯¸ ì½”ë“œ Top3</h3>
          <div id="top3" class="medals"></div>
        </div>

        <!-- ì¶”ì²œ ì§„ë¡œ + í•„ìš” ì—­ëŸ‰ -->
        <div class="grid cols-2" style="margin-top:14px">
          <div class="card">
            <div style="display:flex; gap:10px; align-items:center">
              <img id="careerImg" alt="ì¶”ì²œ ì§„ë¡œ ì´ë¯¸ì§€"
                   style="width:60px;height:60px;border-radius:14px;object-fit:cover; background:#fff; border:1px solid #eef2f7" />
              <div>
                <div class="badge">ğŸ¯ ì¶”ì²œ ì§„ë¡œ</div>
                <h3 id="careerTitle" style="margin:6px 0 4px; font-size:22px"></h3>
                <div id="careerGrowth" class="sub hidden"></div>
              </div>
            </div>

            <div class="spc"></div>
            <strong>ğŸ’¼ ê´€ë ¨ ì§ì—…</strong>
            <div id="jobList" class="jobs" style="margin-top:8px"></div>
          </div>

          <div class="card">
            <strong>âš¡ í•„ìš” ì—­ëŸ‰</strong>
            <ul id="skillList" style="margin:10px 0 0 18px"></ul>

            <div class="spc"></div>
            <strong>ğŸ—ºï¸ ì§„ë¡œ ë¡œë“œë§µ</strong>
            <div class="road">
              <ul id="roadHigh"></ul>
              <ul id="roadCollege"></ul>
              <ul id="roadExp"></ul>
            </div>
          </div>
        </div>

        <!-- ì „ì²´ ìœ í˜• ì ìˆ˜ -->
        <div class="card" style="margin-top:14px">
          <h3 style="margin:0 0 10px">ìœ í˜•ë³„ ì ìˆ˜</h3>
          <div id="scoreBoard" class="grid"></div>
          <div class="spc"></div>
          <div class="muted">ì´ ë¶„ì„ì€ ì„¤ë¬¸ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì°¸ê³  ìë£Œì´ë©°, íŒë‹¨ ì‹œ ë‹¤ì–‘í•œ ìš”ì†Œë¥¼ í•¨ê»˜ ê³ ë ¤í•´ ì£¼ì„¸ìš”.</div>
        </div>
      </div>

      <div class="spc"></div>
      <div class="center" style="gap:10px">
        <button id="saveJpg" class="btn" type="button">ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ JPEGë¡œ ì €ì¥</button>
        <button id="restart" class="ghost" type="button">ë‹¤ì‹œ ì‹œì‘</button>
      </div>
    </section>

  </main>
</div>

<script>
/** -----------------------------
 * ë°ì´í„°: ì§ˆë¬¸(36), ìœ í˜• ì •ë³´, ì»¤ë¦¬ì–´ ë§¤í•‘
 * ----------------------------- */
const questions = [
  // R
  { id:1, type:'R', text:'ë¡œë´‡ì„ ì¡°ë¦½í•˜ê±°ë‚˜ 3D í”„ë¦°í„°ë¡œ ë¬¼ê±´ì„ ë§Œë“¤ ë•Œ ì¬ë¯¸ë¥¼ ëŠë‚€ë‹¤.', emoji:'âš™ï¸', character:'ë¯¸ë˜ ì—”ì§€ë‹ˆì–´' },
  { id:2, type:'R', text:'ë°–ì—ì„œ ì‹ë¬¼ì„ í‚¤ìš°ê±°ë‚˜ ë™ë¬¼ì„ ëŒë³´ëŠ” í™œë™ì„ ì¢‹ì•„í•œë‹¤.', emoji:'ğŸŒ±', character:'ë°”ì´ì˜¤ ì „ë¬¸ê°€' },
  { id:3, type:'R', text:'ê¸°ê³„ë‚˜ ì „ì„ ì´ ê³ ì¥ ë‚¬ì„ ë•Œ ì›ì¸ì„ ì°¾ê³  ê³ ì¹˜ëŠ” ê²Œ í¥ë¯¸ë¡­ë‹¤.', emoji:'ğŸ”§', character:'ìœ ì§€ë³´ìˆ˜ ê¸°ìˆ ì' },
  { id:4, type:'R', text:'ê±´ë¬¼ì´ë‚˜ ì¸í…Œë¦¬ì–´ ëª¨í˜•ì„ ì„¤ê³„í•˜ê³  ë§Œë“œëŠ” ì¼ì´ ì¬ë¯¸ìˆë‹¤.', emoji:'ğŸ—ï¸', character:'ìŠ¤ë§ˆíŠ¸ ê±´ì„¤ê°€' },
  { id:5, type:'R', text:'ì‚¬ëŒì„ êµ¬í•˜ê±°ë‚˜ ì•ˆì „ì„ ì§€í‚¤ëŠ” ì¼(ì†Œë°©, ì‘ê¸‰ êµ¬ì¡° ë“±)ì— ê´€ì‹¬ì´ ìˆë‹¤.', emoji:'ğŸš¨', character:'ì•ˆì „ ìš”ì›' },
  { id:6, type:'R', text:'ê°€ìƒí˜„ì‹¤(VR)ë¡œ ê¸°ê³„ ì¡°ì‘ì´ë‚˜ ì‹¤í—˜ì„ ì²´í—˜í•´ë³´ëŠ” ê²Œ ì¢‹ë‹¤.', emoji:'ğŸ¥½', character:'VR íŠ¸ë ˆì´ë„ˆ' },
  // I
  { id:7, type:'I', text:'ìˆ«ìë‚˜ ìë£Œë¥¼ ë¶„ì„í•´ ìˆ¨ì€ ê·œì¹™ì„ ì°¾ì•„ë‚´ëŠ” ê²Œ ì¦ê²ë‹¤.', emoji:'ğŸ“Š', character:'ë¹…ë°ì´í„° ë¶„ì„ê°€' },
  { id:8, type:'I', text:'ì‚¬ëŒì˜ ë§ˆìŒì´ë‚˜ ë‡Œì˜ ì‘ë™ ì›ë¦¬ë¥¼ ê¹Šì´ ì•Œì•„ê°€ê³  ì‹¶ë‹¤.', emoji:'ğŸ§ ', character:'ì¸ì§€ ê³¼í•™ì' },
  { id:9, type:'I', text:'ì‹¤í—˜ì„ í†µí•´ ìƒˆë¡œìš´ ì‚¬ì‹¤ì„ ë°œê²¬í•  ë•Œ í¥ë¯¸ë¥¼ ëŠë‚€ë‹¤.', emoji:'ğŸ”¬', character:'ì—°êµ¬ì›' },
  { id:10, type:'I', text:'AI(ì¸ê³µì§€ëŠ¥)ì´ë‚˜ í”„ë¡œê·¸ë¨ ì˜¤ë¥˜ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” ê²Œ ì¬ë¯¸ìˆë‹¤.', emoji:'ğŸ¤–', character:'AI ë””ë²„ê±°' },
  { id:11, type:'I', text:'ìš°ì£¼ë‚˜ ë¯¸ë˜ ì‚¬íšŒì²˜ëŸ¼ ì•„ì§ ëª¨ë¥´ëŠ” ì„¸ê³„ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ë§ë‹¤.', emoji:'ğŸ”­', character:'ë¯¸ë˜í•™ì' },
  { id:12, type:'I', text:'ì¶”ë¦¬ ê²Œì„ì´ë‚˜ ë…¼ë¦¬ ë¬¸ì œë¥¼ í’€ë©° ê²°ë¡ ì„ ì°¾ì•„ë‚´ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.', emoji:'ğŸ”', character:'ë…¼ë¦¬í•™ì' },
  // A
  { id:13, type:'A', text:'ê·¸ë¦¼, ìŒì•…, ê¸€ì“°ê¸° ë“±ìœ¼ë¡œ ë‚´ ìƒê°ì„ í‘œí˜„í•˜ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.', emoji:'ğŸ¨', character:'ë©€í‹° ì•„í‹°ìŠ¤íŠ¸' },
  { id:14, type:'A', text:'ë””ì§€í„¸ ë“œë¡œì‰ì´ë‚˜ ë¯¸ë””ì–´ ì•„íŠ¸ ê°™ì€ ìƒˆë¡œìš´ ì˜ˆìˆ  í™œë™ì´ í¥ë¯¸ë¡­ë‹¤.', emoji:'ğŸ’»', character:'ë¯¸ë””ì–´ ì•„í‹°ìŠ¤íŠ¸' },
  { id:15, type:'A', text:'ì˜ìƒ í¸ì§‘, ì›¹íˆ°, ê²Œì„ ìŠ¤í† ë¦¬ì²˜ëŸ¼ ì½˜í…ì¸ ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ê³  ì‹¶ë‹¤.', emoji:'ğŸ¬', character:'ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°' },
  { id:16, type:'A', text:'íŒ¨ì…˜, ê³µì—°, ê³µê°„ ë””ìì¸ ë“± ë©‹ì§€ê³  ì•„ë¦„ë‹¤ìš´ ê²ƒì„ ë§Œë“œëŠ” ê²Œ ì¦ê²ë‹¤.', emoji:'âœ¨', character:'ë””ìì´ë„ˆ' },
  { id:17, type:'A', text:'ììœ ë¡­ê³  ê°œì„± ìˆëŠ” í™˜ê²½ì—ì„œ ì¼í•  ë•Œ ë” ì°½ì˜ì ì´ë¼ê³  ëŠë‚€ë‹¤.', emoji:'ğŸ¦‹', character:'ììœ  ì˜í˜¼' },
  { id:18, type:'A', text:'ì‚¬ëŒë“¤ì—ê²Œ ê°ë™ì´ë‚˜ ì¬ë¯¸ë¥¼ ì£¼ëŠ” ì‘í’ˆì„ ë§Œë“¤ê³  ì‹¶ë‹¤.', emoji:'ğŸ­', character:'ê°ì„± ì „ë‹¬ì' },
  // S
  { id:19, type:'S', text:'ë„ì›€ì´ í•„ìš”í•œ ì‚¬ëŒì„ ë„ìš¸ ë•Œ ë¿Œë“¯í•¨ì„ ëŠë‚€ë‹¤.', emoji:'ğŸ¤', character:'ì‚¬íšŒ ë´‰ì‚¬ì' },
  { id:20, type:'S', text:'ì¹œêµ¬ì˜ ê³ ë¯¼ì„ ë“£ê³  ìœ„ë¡œí•´ì£¼ëŠ” ê²Œ ìì—°ìŠ¤ëŸ½ë‹¤.', emoji:'ğŸ’¬', character:'ì‹¬ë¦¬ ìƒë‹´ê°€' },
  { id:21, type:'S', text:'ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ì§€ì‹ì´ë‚˜ ê¸°ìˆ ì„ ì‰½ê²Œ ê°€ë¥´ì³ì£¼ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.', emoji:'ğŸ“š', character:'êµìœ¡ ì½”ì¹˜' },
  { id:22, type:'S', text:'ì‚¬ëŒë“¤ì˜ ê±´ê°•ê³¼ íšŒë³µì„ ë•ëŠ” ë³´ê±´Â·ì˜ë£Œ ê´€ë ¨ ì¼ì— ê´€ì‹¬ì´ ìˆë‹¤.', emoji:'âš•ï¸', character:'í—¬ìŠ¤ì¼€ì–´ ì „ë¬¸ê°€' },
  { id:23, type:'S', text:'ë‹¤ë¥¸ ë‚˜ë¼ ì‚¬ëŒë“¤ê³¼ í˜‘ë ¥í•´ í•¨ê»˜ ëª©í‘œë¥¼ ì´ë£¨ëŠ” ê²Œ ì¬ë¯¸ìˆë‹¤.', emoji:'ğŸŒ', character:'ê¸€ë¡œë²Œ í˜‘ë ¥ê°€' },
  { id:24, type:'S', text:'ì˜¨ë¼ì¸ ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ì‚¬ëŒë“¤ì˜ ì˜ê²¬ì„ ëª¨ìœ¼ê³  ì¡°ì •í•˜ëŠ” ê±¸ ì˜í•œë‹¤.', emoji:'ğŸ’»', character:'ì»¤ë®¤ë‹ˆí‹° ë§¤ë‹ˆì €' },
  // E
  { id:25, type:'E', text:'ìƒˆë¡œìš´ ì•„ì´ë””ì–´ë¥¼ ë‚´ê³  ì‚¬ëŒë“¤ì—ê²Œ ì„¤ëª…í•˜ê±°ë‚˜ ì„¤ë“í•˜ëŠ” ê²Œ ì¬ë¯¸ìˆë‹¤.', emoji:'ğŸ’¡', character:'ìŠ¤íƒ€íŠ¸ì—… CEO' },
  { id:26, type:'E', text:'íŒ€ í”„ë¡œì íŠ¸ì—ì„œ ë¦¬ë”ê°€ ë˜ì–´ ì‚¬ëŒë“¤ì„ ì´ë„ëŠ” ê²Œ ì˜ ë§ëŠ”ë‹¤..', emoji:'ğŸ‘‘', character:'ì¹´ë¦¬ìŠ¤ë§ˆ ë¦¬ë”' },
  { id:27, type:'E', text:'ì£¼ì‹, ë¶€ë™ì‚°, ê°€ìƒí™”í ë“± íˆ¬ì í™œë™ì— í¥ë¯¸ê°€ ìˆë‹¤.', emoji:'ğŸ’°', character:'í•€í…Œí¬ ì „ë¬¸ê°€' },
  { id:28, type:'E', text:'ì—¬ëŸ¬ ì‚¬ëŒ ì•ì—ì„œ ë°œí‘œí•  ë•Œ ìì‹ ê°ì´ ìˆê³  ë§ì„ ì˜í•œë‹¤.', emoji:'ğŸ¤', character:'í˜‘ìƒê°€' },
  { id:29, type:'E', text:'ì„¸ê³„ì˜ íŠ¸ë Œë“œë¥¼ ì½ê³  ìƒˆë¡œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íšŒë¥¼ ì°¾ëŠ” ê²Œ í¥ë¯¸ë¡­ë‹¤.', emoji:'ğŸŒ', character:'êµ­ì œ ë¹„ì¦ˆë‹ˆìŠ¤ë§¨' },
  { id:30, type:'E', text:'SNSë‚˜ ê°œì¸ ë¸Œëœë“œë¥¼ í†µí•´ ì˜í–¥ë ¥ì„ í‚¤ìš°ëŠ” ê±¸ ì¦ê¸´ë‹¤.', emoji:'ğŸ“±', character:'ì¸í”Œë£¨ì–¸ì„œ' },
  // C
  { id:31, type:'C', text:'ìë£Œë‚˜ ë¬¸ì„œë¥¼ ì •ë¦¬í•˜ê³  ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê±¸ ì˜í•œë‹¤.', emoji:'ğŸ—‚ï¸', character:'ì •ë³´ ê´€ë¦¬ì' },
  { id:32, type:'C', text:'ì •í•´ì§„ ê·œì¹™ì— ë”°ë¼ ì¼ì„ ì •í™•í•˜ê²Œ ì²˜ë¦¬í•  ë•Œ ë§Œì¡±ê°ì„ ëŠë‚€ë‹¤.', emoji:'âœ…', character:'í–‰ì • ì „ë¬¸ê°€' },
  { id:33, type:'C', text:'ìˆ«ìë¥¼ ë‹¤ë£¨ê±°ë‚˜ ì˜ˆì‚°ì„ ê³„íší•˜ëŠ” ì¼ì„ ì¢‹ì•„í•œë‹¤.', emoji:'ğŸ’µ', character:'íšŒê³„ì‚¬' },
  { id:34, type:'C', text:'ì •ë³´ë³´ì•ˆì´ë‚˜ ê°œì¸ì •ë³´ ë³´í˜¸ì²˜ëŸ¼ ì‹œìŠ¤í…œ ì•ˆì „ì„ ì§€í‚¤ëŠ” ì¼ì— ê´€ì‹¬ì´ ìˆë‹¤.', emoji:'ğŸ”’', character:'ë³´ì•ˆ ì „ë¬¸ê°€' },
  { id:35, type:'C', text:'ë¬¸ì„œë‚˜ ìë£Œ(ë³´ê³ ì„œ)ë¥¼ ê¹”ë”í•˜ê³  ë³´ê¸° ì¢‹ê²Œ ë§Œë“œëŠ” ê±¸ ì‹ ê²½ ì“´ë‹¤.', emoji:'ğŸ“‹', character:'ê¸°íš ë¹„ì„œ' },
  { id:36, type:'C', text:'ìë™í™” ë„êµ¬ë‚˜ í”„ë¡œê·¸ë¨ì„ ì´ìš©í•´ ì¼ì„ ë” íš¨ìœ¨ì ìœ¼ë¡œ í•˜ëŠ” ë°©ë²•ì„ ì°¾ëŠ”ë‹¤.', emoji:'âš¡', character:'ì—…ë¬´ íš¨ìœ¨í™” ì „ë¬¸ê°€' },
];

const typeInfo = {
  R:{ name:'ì‹¤ì¬í˜•', color:'#3b82f6' },
  I:{ name:'íƒêµ¬í˜•', color:'#8b5cf6' },
  A:{ name:'ì˜ˆìˆ í˜•', color:'#ec4899' },
  S:{ name:'ì‚¬íšŒí˜•', color:'#22c55e' },
  E:{ name:'ì§„ì·¨í˜•', color:'#f59e0b' },
  C:{ name:'ê´€ìŠµí˜•', color:'#14b8a6' },
};

const careerPaths = {
  IA:{ title:'AI ê¸°ë°˜ ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°',
       jobs:['ë°ì´í„° ì‹œê°í™” ë””ìì´ë„ˆ','UX ë¦¬ì„œì²˜','ë¯¸ë””ì–´ ì•„í‹°ìŠ¤íŠ¸','AI ì•„íŠ¸ ë””ë ‰í„°'],
       roadmap:{high:'ë¯¸ìˆ , ì •ë³´, ë¯¸ë””ì–´ êµê³¼ ì„ íƒ', college:'ìœµí•©ë””ìì¸, ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤, ë¯¸ë””ì–´ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì „ê³µ', experience:'UI/UX ê³µëª¨ì „, í¬íŠ¸í´ë¦¬ì˜¤, ë””ìì¸ì”½í‚¹ ì›Œí¬ìˆ'},
       skills:['ì°½ì˜ì  ë¬¸ì œí•´ê²°','ë°ì´í„° ë¦¬í„°ëŸ¬ì‹œ','ë””ìì¸ ì‚¬ê³ '], growth:85 },
  IE:{ title:'AI ìŠ¤íƒ€íŠ¸ì—… ì „ëµê°€',
       jobs:['AI ê¸°íšì','í…Œí¬ PM','ë¹„ì¦ˆë‹ˆìŠ¤ ì• ë„ë¦¬ìŠ¤íŠ¸','ë””ì§€í„¸ ì»¨ì„¤í„´íŠ¸'],
       roadmap:{high:'ìˆ˜í•™, ì¸ê³µì§€ëŠ¥ ê¸°ì´ˆ, ê²½ì œ', college:'ê²½ì˜ì •ë³´, ì»´ê³µ, ì‚°ì—…ê³µí•™', experience:'ì°½ì—… ë™ì•„ë¦¬, BM í”„ë¡œì íŠ¸, í•´ì»¤í†¤'},
       skills:['ë…¼ë¦¬ì  ì‚¬ê³ ','ë¹„ì¦ˆë‹ˆìŠ¤ ê°ê°','ë°ì´í„° ë¶„ì„'], growth:92 },
  AE:{ title:'ë¸Œëœë“œ ë§ˆì¼€í„°/ì¸í”Œë£¨ì–¸ì„œ',
       jobs:['ë””ì§€í„¸ ë§ˆì¼€í„°','ë¸Œëœë“œ ë§¤ë‹ˆì €','ì½˜í…ì¸  ê¸°íšì','SNS ì „ëµê°€'],
       roadmap:{high:'í™”ì‘, ì‹¬ë¦¬, ì‚¬íšŒë¬¸í™”', college:'ê´‘ê³ í™ë³´, ë¬¸í™”ì½˜í…ì¸ , ë§ˆì¼€íŒ…', experience:'SNS ìš´ì˜, ì¸í„´ì‹­, ë¸Œëœë”© í”„ë¡œì íŠ¸'},
       skills:['ì°½ì˜ì„±','ì»¤ë®¤ë‹ˆì¼€ì´ì…˜','íŠ¸ë Œë“œ ë¶„ì„'], growth:78 },
  SE:{ title:'ì†Œì…œ ì„íŒ©íŠ¸ ë¦¬ë”',
       jobs:['ì‚¬íšŒì ê¸°ì—…ê°€','CSR ë§¤ë‹ˆì €','ë¹„ì˜ë¦¬ ê¸°íšì','ì„íŒ©íŠ¸ íˆ¬ì'],
       roadmap:{high:'ì‚¬íšŒë¬¸í™”, ìœ¤ë¦¬, ê²½ì œ', college:'ì‚¬íšŒë³µì§€, ê²½ì˜, êµ­ì œê°œë°œ', experience:'ë´‰ì‚¬ ë¦¬ë”©, ì‚¬íšŒí˜ì‹  ìº í”„, í¬ë¼ìš°ë“œí€ë”©'},
       skills:['ê³µê°','ë¦¬ë”ì‹­','ë¬¸ì œí•´ê²°ë ¥'], growth:73 },
  RI:{ title:'ì²¨ë‹¨ ê¸°ìˆ  ì—°êµ¬ì',
       jobs:['ë¡œë´‡ê³µí•™ì','IoT ê°œë°œì','ë°”ì´ì˜¤ ì—”ì§€ë‹ˆì–´','ìš°ì£¼í•­ê³µ ê¸°ìˆ ì'],
       roadmap:{high:'ë¬¼ë¦¬, í™”í•™, ì •ë³´', college:'ê¸°ê³„Â·ì „ìÂ·ìƒëª…ê³µí•™', experience:'ê³¼í•™ë™ì•„ë¦¬, ë°œëª…, ì—°êµ¬ í”„ë¡œì íŠ¸'},
       skills:['ê¸°ìˆ ì  ì´í•´','ì‹¤í—˜ ì„¤ê³„','ë…¼ë¦¬ì  ì‚¬ê³ '], growth:88 },
  RS:{ title:'í—¬ìŠ¤ì¼€ì–´ ê¸°ìˆ  ì „ë¬¸ê°€',
       jobs:['ì˜ë£Œê¸°ê¸° ì—”ì§€ë‹ˆì–´','ì¬í™œ ì¹˜ë£Œì‚¬','ìŠ¤í¬ì¸  íŠ¸ë ˆì´ë„ˆ','ì‘ê¸‰êµ¬ì¡°ì‚¬'],
       roadmap:{high:'ìƒëª…, ì²´ìœ¡, ë³´ê±´', college:'ì˜ê³µí•™, ë¬¼ë¦¬ì¹˜ë£Œ, ì‘ê¸‰êµ¬ì¡°', experience:'ì˜ë£Œ ë´‰ì‚¬, ì‘ê¸‰ì²˜ì¹˜, ì¬í™œ ì‹¤ìŠµ'},
       skills:['ì‹ ì²´ í™œë™ì„±','ê³µê°','ìœ„ê¸° ëŒ€ì‘'], growth:81 },
  IS:{ title:'ì¸ê°„ ì¤‘ì‹¬ ì—°êµ¬ì',
       jobs:['ì‹¬ë¦¬í•™ì','êµìœ¡ ì—°êµ¬ì›','ì¸ì§€ê³¼í•™ì','UX ë¦¬ì„œì²˜'],
       roadmap:{high:'ì‹¬ë¦¬, ì‚¬íšŒë¬¸í™”, ìƒëª…', college:'ì‹¬ë¦¬Â·êµìœ¡Â·ì¸ì§€ê³¼í•™', experience:'ìƒë‹´ ë´‰ì‚¬, ì—°êµ¬ ë³´ì¡°, ì‚¬ìš©ì ì¡°ì‚¬'},
       skills:['ë¶„ì„ë ¥','ê³µê°','ì—°êµ¬ ì„¤ê³„'], growth:76 },
  IC:{ title:'ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸',
       jobs:['ë¹…ë°ì´í„° ë¶„ì„ê°€','AI ì—”ì§€ë‹ˆì–´','ì •ë³´ë³´ì•ˆ ì—°êµ¬ì›','í€€íŠ¸ ì• ë„ë¦¬ìŠ¤íŠ¸'],
       roadmap:{high:'ìˆ˜í•™, ì •ë³´, í†µê³„', college:'í†µê³„Â·ì»´ê³µÂ·ë°ì‚¬', experience:'ë°ì´í„° ê³µëª¨ì „, ë¶€íŠ¸ìº í”„, ì˜¤í”ˆì†ŒìŠ¤'},
       skills:['ë°ì´í„° ë¶„ì„','í”„ë¡œê·¸ë˜ë°','ë…¼ë¦¬ì  ì‚¬ê³ '], growth:95 },
  AS:{ title:'íë§ ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°',
       jobs:['ìŒì•… ì¹˜ë£Œì‚¬','ì˜ˆìˆ  ì¹˜ë£Œì‚¬','ë¬¸í™”ê¸°íšì','ì»¤ë®¤ë‹ˆí‹° ì•„í‹°ìŠ¤íŠ¸'],
       roadmap:{high:'ìŒì•…, ë¯¸ìˆ , ì‹¬ë¦¬', college:'ì˜ˆìˆ ì¹˜ë£ŒÂ·ë¬¸í™”ì˜ˆìˆ êµìœ¡Â·ìƒë‹´', experience:'ì˜ˆìˆ  ë´‰ì‚¬, í”„ë¡œê·¸ë¨ ë³´ì¡°, ì»¤ë®¤ë‹ˆí‹° í”„ë¡œì íŠ¸'},
       skills:['ì°½ì˜ì„±','ê³µê°','ê°ì„± í‘œí˜„'], growth:71 },
  AC:{ title:'ë””ì§€í„¸ ì•„ì¹´ì´ë¸Œ ì „ë¬¸ê°€',
       jobs:['íë ˆì´í„°','ë””ì§€í„¸ ì•„í‚¤ë¹„ìŠ¤íŠ¸','ì½˜í…ì¸  ë§¤ë‹ˆì €','ë°•ë¬¼ê´€ ì „ë¬¸ê°€'],
       roadmap:{high:'ë¯¸ìˆ , ì—­ì‚¬, ì •ë³´', college:'ë¬¸í—Œì •ë³´Â·ë°•ë¬¼ê´€í•™Â·ë¬¸í™”ì¬', experience:'ì „ì‹œ ê¸°íš, ì•„ì¹´ì´ë¹™, ë‹µì‚¬'},
       skills:['ì°½ì˜ì„±','ì²´ê³„ì  ì‚¬ê³ ','ë””ì§€í„¸ ë¦¬í„°ëŸ¬ì‹œ'], growth:68 },
  SC:{ title:'í–‰ì • ì„œë¹„ìŠ¤ ì „ë¬¸ê°€',
       jobs:['ê³µë¬´ì›','ì¸ì‚¬ ë‹´ë‹¹','í–‰ì •ì‚¬','ë¹„ì„œ'],
       roadmap:{high:'ì‚¬íšŒë¬¸í™”, ë²•, ê²½ì œ', college:'í–‰ì •í•™Â·ê²½ì˜í•™Â·ë²•í•™', experience:'í•™ìƒíšŒ, í–‰ì • ì¸í„´ì‹­, ê³µëª¨ì „'},
       skills:['ì¡°ì§ë ¥','ê³µê°','ì—…ë¬´ ì²˜ë¦¬'], growth:65 },
  EC:{ title:'ê¸ˆìœµ ì „ëµê°€',
       jobs:['ì¬ë¬´ ë¶„ì„ê°€','íˆ¬ì ìƒë‹´ì‚¬','íšŒê³„ì‚¬','ì„¸ë¬´ì‚¬'],
       roadmap:{high:'ê²½ì œ, ìˆ˜í•™, ì •ë³´', college:'ê²½ì˜Â·íšŒê³„Â·ê¸ˆìœµ', experience:'ëª¨ì˜íˆ¬ì, ìê²©ì¦, ê¸ˆìœµ ì¸í„´ì‹­'},
       skills:['ë¦¬ë”ì‹­','ìˆ˜ë¦¬','ì¬ë¬´ ë¶„ì„'], growth:82 },
  RA:{ title:'ë©”ì´ì»¤ í¬ë¦¬ì—ì´í„°',
       jobs:['ì œí’ˆ ë””ìì´ë„ˆ','3D ëª¨ë¸ëŸ¬','ê±´ì¶•ê°€','ì¸í…Œë¦¬ì–´ ë””ìì´ë„ˆ'],
       roadmap:{high:'ë¯¸ìˆ , ê°€ì •, ë¬¼ë¦¬', college:'ì‚°ì—…ë””ìì¸Â·ê±´ì¶•Â·ì‹¤ë‚´', experience:'ë©”ì´ì»¤ ë™ì•„ë¦¬, ë””ìì¸ ê³µëª¨ì „, 3D í”„ë¦°íŒ…'},
       skills:['ê¸°ìˆ ','ì°½ì˜ì„±','ê³µê°„ ê°ê°'], growth:79 },
  RC:{ title:'ìŠ¤ë§ˆíŠ¸ ì‹œìŠ¤í…œ ìš´ì˜ì',
       jobs:['ì„¤ë¹„ ê´€ë¦¬ì','í’ˆì§ˆ ê´€ë¦¬ì','ìƒì‚° ê´€ë¦¬ì','ì‹œìŠ¤í…œ ì—”ì§€ë‹ˆì–´'],
       roadmap:{high:'ê°€ì •, ì •ë³´, ìˆ˜í•™', college:'ì‚°ì—…Â·ê¸°ê³„Â·ì „ê¸°ê³µí•™', experience:'í˜„ì¥ ì‹¤ìŠµ, ìê²©ì¦, ìë™í™” í”„ë¡œì íŠ¸'},
       skills:['ê¸°ìˆ ','ì²´ê³„ì  ì‚¬ê³ ','í’ˆì§ˆ ê´€ë¦¬'], growth:74 },
  RE:{ title:'í˜„ì¥ ë¦¬ë”',
       jobs:['ê±´ì„¤ ê°ë…','ë¬¼ë¥˜ ê´€ë¦¬ì','ì•ˆì „ ê´€ë¦¬ì','ìŠ¤í¬ì¸  ì—ì´ì „íŠ¸'],
       roadmap:{high:'ì²´ìœ¡, ê°€ì •, ê²½ì˜', college:'ê±´ì„¤Â·ë¬¼ë¥˜Â·ì•ˆì „ê³µí•™', experience:'í˜„ì¥ ì‹¤ìŠµ, ì•ˆì „ êµìœ¡, PM'},
       skills:['ì‹ ì²´ í™œë™ì„±','ë¦¬ë”ì‹­','ìœ„ê¸° ê´€ë¦¬'], growth:72 },
};

/** -----------------------------
 * ìƒíƒœ & ì—˜ë¦¬ë¨¼íŠ¸
 * ----------------------------- */
let idx = 0;
const answers = {};
const $ = (s)=>document.querySelector(s);
const intro = $('#intro'), survey = $('#survey'), result = $('#result');
const startBtn = $('#startBtn'), prevBtn = $('#prev'), nextBtn = $('#next');
const qType = $('#qType'), qEmoji = $('#qEmoji'), qText = $('#qText'), qRole = $('#qRole');
const choicesWrap = $('#choices'), pgFill = $('#pgFill');
const saveJpg = $('#saveJpg'), restartBtn = $('#restart');
const careerImg = $('#careerImg');

/** ë„¤ë¹„ê²Œì´ì…˜ */
startBtn.onclick = () => goSurvey();
prevBtn.onclick = () => { if(idx>0){ idx--; renderQuestion(); } };
nextBtn.onclick = () => { if(idx < questions.length-1){ idx++; renderQuestion(); } else { calcAndRenderResult(); } };
restartBtn.onclick = () => { location.reload(); };

/** ì„¤ë¬¸ */
function goSurvey(){ intro.classList.add('hidden'); survey.classList.remove('hidden'); idx=0; renderQuestion(); }

function renderQuestion(){
  const q = questions[idx];
  const progress = ((idx+1) / questions.length) * 100;
  pgFill.style.width = progress+'%';

  qType.textContent = `${q.type} â€¢ ${typeInfo[q.type].name}`;
  qType.className = 'chip ' + q.type;
  qEmoji.textContent = q.emoji;
  qText.textContent = q.text;
  qRole.textContent = `ğŸ’¼ ${q.character}`;

  choicesWrap.innerHTML = '';
  const opts = [
    {v:5, label:'ë§¤ìš° ê·¸ë ‡ë‹¤'},{v:4, label:'ê·¸ë ‡ë‹¤'},{v:3, label:'ë³´í†µì´ë‹¤'},{v:2, label:'ê·¸ë ‡ì§€ ì•Šë‹¤'},{v:1, label:'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤'}
  ];
  const prevVal = answers[q.id];

  opts.forEach(o=>{
    const b = document.createElement('button');
    b.type='button';
    b.className='choice' + (prevVal===o.v ? ' active':'' );
    b.innerHTML = `<span>${o.label}</span><strong>${o.v}</strong>`;
    b.onclick = ()=>{
      document.querySelectorAll('.choice').forEach(c=>c.classList.remove('active'));
      b.classList.add('active'); answers[q.id] = o.v; nextBtn.disabled = false;
    }
    choicesWrap.appendChild(b);
  });

  prevBtn.disabled = idx===0;
  nextBtn.textContent = idx===questions.length-1 ? 'ê²°ê³¼ ë³´ê¸° âœ¨' : 'ë‹¤ìŒ â†’';
  nextBtn.disabled = (prevVal==null);
}

/** ê²°ê³¼ ë Œë” */
function calcAndRenderResult(){
  const scores = {R:0,I:0,A:0,S:0,E:0,C:0};
  questions.forEach(q=>{ if(answers[q.id]) scores[q.type] += answers[q.id]; });

  const all = Object.entries(scores)
    .map(([t,score])=>({type:t, score, pct: Math.round((score/30)*100)}))
    .sort((a,b)=>b.score-a.score);

  const top = all.slice(0,3);
  const code = top[0].type + top[1].type;
  let career = careerPaths[code] || careerPaths[code.split('').reverse().join('')];
  if(!career){
    const fallback = ['IA','IE','RI','IS','IC','AE','SE'].find(c=>c.includes(top[0].type));
    career = careerPaths[fallback] || careerPaths['IA'];
  }

  survey.classList.add('hidden'); result.classList.remove('hidden');

  // Top3
  const top3 = $('#top3'); top3.innerHTML = '';
  top.forEach((t,i)=>{
    const m = document.createElement('div');
    m.className='medal'; m.style.background = typeInfo[t.type].color;
    m.innerHTML = `<div style="font-size:12px">${['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]}</div>
                   <div style="font-size:28px;line-height:1">${t.type}</div>
                   <small>${typeInfo[t.type].name}</small>`;
    top3.appendChild(m);
  });

  // ì¶”ì²œ ì§„ë¡œ + ì´ë¯¸ì§€
  $('#careerTitle').textContent = career.title;
  const imgCode = (careerPaths[code]) ? code : code.split('').reverse().join('');
  careerImg.crossOrigin = 'anonymous';
  careerImg.src = `assets/${imgCode}.png`;
  careerImg.onerror = ()=>{ careerImg.src = makeFallbackBadge(imgCode); };

  // ì§ì—…/ì—­ëŸ‰/ë¡œë“œë§µ
  const jobs = $('#jobList'); jobs.innerHTML='';
  career.jobs.forEach(j=>{
    const el = document.createElement('div');
    el.className='job'; el.innerHTML = `<span style="width:8px;height:8px;border-radius:999px;background:#7c3aed;display:inline-block"></span>${j}`;
    jobs.appendChild(el);
  });
  const skills = $('#skillList'); skills.innerHTML='';
  career.skills.forEach(s=>{ const li = document.createElement('li'); li.textContent = s; skills.appendChild(li); });

  $('#roadHigh').innerHTML = `<li><strong>ê³ ë“±í•™êµ ë‹¨ê³„ â€”</strong> ${career.roadmap.high}</li>`;
  $('#roadCollege').innerHTML = `<li><strong>ëŒ€í•™ ë‹¨ê³„ â€”</strong> ${career.roadmap.college}</li>`;
  $('#roadExp').innerHTML = `<li><strong>ê²½í—˜ ë° í™œë™ â€”</strong> ${career.roadmap.experience}</li>`;

  const board = $('#scoreBoard'); board.innerHTML='';
  all.forEach(item=>{
    const row = document.createElement('div');
    row.className='score-row';
    row.innerHTML = `
      <div class="score-name">${typeInfo[item.type].name} (${item.type})</div>
      <div class="bar"><i style="width:${item.pct}%; background:${typeInfo[item.type].color}"></i></div>
      <div style="text-align:right; font-weight:800">${item.pct}%</div>`;
    board.appendChild(row);
  });
}

/** ê²°ê³¼ ë°°ì§€ SVG(ëŒ€ì²´ ì´ë¯¸ì§€) */
function makeFallbackBadge(code){
  const txt = (code||'AI').slice(0,2).toUpperCase();
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128' viewBox='0 0 128 128'>
    <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop stop-color='#7c3aed'/><stop offset='1' stop-color='#ec4899'/></linearGradient></defs>
    <rect rx='24' ry='24' width='128' height='128' fill='url(#g)'/>
    <text x='50%' y='58%' text-anchor='middle' font-family='Pretendard,Arial,Helvetica,sans-serif' font-size='64' font-weight='800' fill='white'>${txt}</text>
  </svg>`;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
}

/** ìœ í‹¸: íŠ¹ì • ì—˜ë¦¬ë¨¼íŠ¸ ë‚´ë¶€ ì´ë¯¸ì§€ ë¡œë”© ëŒ€ê¸° */
function waitImagesLoaded(rootEl){
  const imgs = Array.from(rootEl.querySelectorAll('img'));
  if(imgs.length===0) return Promise.resolve();
  const promises = imgs.map(img => {
    if (img.complete && img.naturalWidth) return Promise.resolve();
    return new Promise(res=>{ img.onload = img.onerror = ()=>res(); });
  });
  return Promise.all(promises);
}

/** JPEG ì €ì¥(í™”ë©´ í­ ê³ ì • ë³€ê²½ ì—†ì´, ì¶œë ¥ ìº”ë²„ìŠ¤ë§Œ ìŠ¤ì¼€ì¼ë§) */
saveJpg.onclick = async ()=>{
  const target = document.getElementById('captureArea');

  // iOS/Safariìš©: ì‚¬ìš©ì í´ë¦­ ì‹œì ì— ìƒˆ ì°½ì„ ë¨¼ì € ì—´ì–´ íŒì—… ì°¨ë‹¨ íšŒí”¼
  const ua = navigator.userAgent; 
  const isIOS = /iPad|iPhone|iPod/.test(ua);
  const isSafari = /^((?!chrome|android).)*safari/i.test(ua);
  const popupWin = (isIOS || isSafari) ? window.open('', '_blank') : null;

  saveJpg.disabled = true;

  // í°íŠ¸/ì´ë¯¸ì§€ ë¡œë“œ ë³´ì¥
  try{ await document.fonts.ready; }catch(e){}
  await waitImagesLoaded(target);

  // ì‹¤ì œ ìº¡ì²˜
  const baseCanvas = await html2canvas(target, {
    backgroundColor:'#ffffff',
    scale: Math.min(2, window.devicePixelRatio || 2),
    useCORS:true
  });

  // ì¶œë ¥ ì‚¬ì´ì¦ˆ(1080px ë„ˆë¹„ + ì—¬ë°± 32px) - í™”ë©´ ë ˆì´ì•„ì›ƒ ë³€ê²½ ì—†ìŒ
  const targetWidth = 1080;
  const margin = 32; // px
  const scale = targetWidth / baseCanvas.width;
  const drawW = Math.round(baseCanvas.width * scale);
  const drawH = Math.round(baseCanvas.height * scale);

  const out = document.createElement('canvas');
  out.width  = drawW + margin*2;
  out.height = drawH + margin*2;
  const ctx = out.getContext('2d');
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0,0,out.width,out.height);
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = 'high';
  ctx.drawImage(baseCanvas, margin, margin, drawW, drawH);

  const dataURL = out.toDataURL('image/jpeg', 0.92);

  if (popupWin) {
    // iOS/Safari : ìƒˆ ì°½ì— ì´ë¯¸ì§€ í‘œì‹œ â†’ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥
    popupWin.document.title = 'ê¸¸ê²Œ ëˆŒëŸ¬ â€œì‚¬ì§„ì— ì¶”ê°€/ì €ì¥â€';
    popupWin.document.body.style.margin = '0';
    const img = popupWin.document.createElement('img');
    img.src = dataURL; img.style.width = '100%'; img.style.height = 'auto';
    popupWin.document.body.appendChild(img);
  } else {
    // ë°ìŠ¤í¬í†±/ì•ˆë“œë¡œì´ë“œ í¬ë¡¬ ë“± : ì§ì ‘ ë‹¤ìš´ë¡œë“œ
    const a = document.createElement('a');
    a.href = dataURL; a.download = 'career-result.jpg';
    document.body.appendChild(a); a.click(); a.remove();
  }

  saveJpg.disabled = false;
};
</script>
</body>
</html>
