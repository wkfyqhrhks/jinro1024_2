<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>진로 관심사 설문조사</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<style>
  :root{
    --bg1:#6c63ff; --bg2:#ff4db6;
    --card:#ffffff; --ink:#111827; --muted:#6b7280;
    --brand:#7c3aed; --brand2:#ec4899; --ok:#10b981; --chip:#f3f4f6;
    --pad: clamp(16px, 3.5vw, 28px);
  }
  html,body{height:100%}
  body{
    margin:0; font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,Arial,Apple SD Gothic Neo,"Noto Sans KR",sans-serif; color:var(--ink);
    background: linear-gradient(135deg, #6a65ff 0%, #a35cff 40%, #db52ff 70%, #ff52a8 100%);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .wrap{min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:24px}
  .container{width:100%; max-width:980px}
  .card{
    background:var(--card); border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,.14);
    padding:var(--pad); overflow:hidden;
  }
  h1{font-size:clamp(24px,4.5vw,40px); margin:0 0 8px}
  .lead{color:var(--muted); margin:0 0 18px; font-size:clamp(14px,2.2vw,18px)}
  .notice{background:linear-gradient(180deg,#fafafa,#f4f5ff); border-radius:18px; padding:18px 20px; margin-top:12px}
  .notice li{margin:.45rem 0}
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
    padding:14px 22px; border-radius:999px; font-weight:700; border:0; cursor:pointer;
    color:#fff; background:linear-gradient(90deg,var(--brand),var(--brand2));
    box-shadow:0 6px 18px rgba(124,58,237,.35);
  }
  .btn:disabled{opacity:.4; cursor:not-allowed}
  .center{display:flex; justify-content:center; margin-top:14px}

  /* 설문/결과 공용 */
  .progress{height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin:8px 0 20px}
  .bar{height:100%; background:linear-gradient(90deg,var(--brand),var(--brand2)); width:0%}

  .grid{display:grid; gap:12px}
  @media (min-width:840px){ .grid.cols-2{grid-template-columns:1fr 1fr} }

  .chip{display:inline-flex; align-items:center; gap:6px; font-weight:700; color:#111;
    background:#f3f4f6; border-radius:16px; padding:6px 10px; font-size:14px}
  .badge{display:inline-grid; place-items:center; width:64px; height:64px; border-radius:16px; color:#fff; font-weight:900}
  .badge.e{background:#f97316} .badge.c{background:#14b8a6} .badge.i{background:#8b5cf6}
  .badge.r{background:#3b82f6} .badge.a{background:#ec4899} .badge.s{background:#22c55e}

  /* 결과 카드 */
  #resultCard{background:#fff; border-radius:22px; padding:var(--pad); }
  .result-row{display:flex; align-items:center; gap:14px}
  .job-illust{
    width:72px; height:72px; border-radius:16px; object-fit:cover; flex:0 0 auto;
    background:#f3f4f6; border:1px solid #eef0f5;
  }
  .sub{color:var(--muted); font-weight:700; margin:8px 0 6px}

  /* 저장 안내 */
  .save-hint{color:#374151; font-size:13px; margin-top:8px}

  /* 캡처 여백을 위해 감싸는 박스 */
  .capture-wrap{
    background:#fff; border-radius:22px;
    padding:32px; /* <- 저장 이미지의 '여백' */
  }
  /* 모바일에서도 직업 이미지 강제 표시 */
  .result-hero{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .result-hero h2{margin:0; font-size:clamp(20px,3.6vw,28px)}
</style>
</head>
<body>
<div class="wrap">
  <div class="container">
    <!-- 인트로 -->
    <div class="card" id="intro">
      <h1>진로 관심사 설문조사</h1>
      <p class="lead">당신의 미래를 위한 첫 걸음</p>
      <div class="notice">
        <strong>📋 설문 안내</strong>
        <ul>
          <li>총 <b>36개</b> 문항에 답변해주세요.</li>
          <li>각 문항은 <b>1~5점</b>으로 평가합니다.</li>
          <li>솔직한 답변이 가장 정확한 결과를 만듭니다.</li>
        </ul>
      </div>
      <div class="center">
        <button class="btn" id="startBtn">설문 시작하기 →</button>
      </div>
    </div>

    <!-- 설문 (데모로 진행률만 보여줌) -->
    <div class="card" id="survey" style="display:none">
      <div class="result-hero">
        <span class="chip">문항 1 / 36</span>
        <span class="chip">응답 0개</span>
      </div>
      <div class="progress"><div class="bar" id="pb" style="width:6%"></div></div>
      <p class="lead">※ 실제 설문 UI는 기존 구현을 사용하세요. 이 샘플은 결과 캡처 동작 검증용입니다.</p>
      <div class="center">
        <button class="btn" id="toResult">결과 페이지로 예시 이동</button>
      </div>
    </div>

    <!-- 결과 -->
    <div class="capture-wrap" id="captureWrap" style="display:none">
      <div id="resultCard">
        <div class="result-hero" style="margin-bottom:10px">
          <div class="chip">🏆 검사 완료</div>
          <h2>당신만의 흥미 코드를 발견했어요!</h2>
        </div>

        <!-- Top3 뱃지 -->
        <div class="card" style="background:#f8fafc; margin:10px 0 18px">
          <div class="sub">나의 흥미 코드 Top3</div>
          <div style="display:flex; gap:10px; flex-wrap:wrap">
            <div class="badge a">A</div>
            <div class="badge e">E</div>
            <div class="badge s">S</div>
          </div>
        </div>

        <!-- 추천 진로 + 직업 이미지 (모바일/데스크톱 모두 표시) -->
        <div class="card" style="background:#f8fafc; margin:10px 0 18px">
          <div class="result-row">
            <!-- ⚠️ 결과 코드에 맞춰 src만 바꿔주세요 (IA, IE, RI, IS, IC, AE, SE, EC, RC, RA, SC, AC, …) -->
            <img id="careerImage" class="job-illust" src="assets/IA.png" alt="직업군 이미지" />
            <div>
              <span class="chip">🎯 추천 진로</span>
              <h3 style="margin:.4rem 0 0">브랜드 마케터/인플루언서</h3>
            </div>
          </div>

          <div class="grid cols-2" style="margin-top:14px">
            <div class="card" style="background:#fff">
              <div class="sub">💼 관련 직업</div>
              <div style="display:grid; gap:8px">
                <div class="chip">디지털 마케터</div>
                <div class="chip">브랜드 매니저</div>
                <div class="chip">콘텐츠 기획자</div>
                <div class="chip">SNS 전략가</div>
              </div>
            </div>
            <div class="card" style="background:#fff">
              <div class="sub">⚡ 필요 역량</div>
              <ul style="margin:8px 0 0 18px; padding:0">
                <li>창의성</li>
                <li>커뮤니케이션</li>
                <li>트렌드 분석</li>
              </ul>
              <div class="sub" style="margin-top:14px">🗺️ 진로 로드맵</div>
              <ol style="margin:8px 0 0 18px; padding:0">
                <li>고등학교 단계 — 화작, 심리, 사회문화</li>
                <li>대학 단계 — 광고홍보, 문화콘텐츠, 마케팅</li>
                <li>경험 및 활동 — SNS 운영, 인턴십, 브랜딩 프로젝트</li>
              </ol>
            </div>
          </div>
        </div>

        <!-- 유형별 점수 바 -->
        <div class="card" style="background:#f8fafc">
          <div class="sub">유형별 점수</div>
          <div style="display:grid; gap:10px">
            <!-- 막대는 width만 변경해서 사용 -->
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>예술형 (A)</span><span>37%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:37%"></div></div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>진취형 (E)</span><span>33%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:33%"></div></div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>사회형 (S)</span><span>23%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:23%"></div></div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>실재형 (R)</span><span>20%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:20%"></div></div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>탐구형 (I)</span><span>27%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:27%"></div></div>
            </div>
            <div>
              <div style="display:flex; justify-content:space-between; font-weight:700"><span>관습형 (C)</span><span>20%</span></div>
              <div class="progress" style="height:12px"><div class="bar" style="width:20%"></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 저장 버튼/안내 -->
      <div class="center" style="gap:8px; margin-top:12px">
        <button class="btn" id="saveJpegBtn">결과를 JPEG로 저장</button>
      </div>
      <div class="center"><div class="save-hint" id="saveHint" aria-live="polite"></div></div>
    </div>
  </div>
</div>

<script>
  // 화면 전환 (데모)
  const intro = document.getElementById('intro');
  const survey = document.getElementById('survey');
  const captureWrap = document.getElementById('captureWrap');
  document.getElementById('startBtn').addEventListener('click', ()=>{
    intro.style.display='none'; survey.style.display='block';
  });
  document.getElementById('toResult').addEventListener('click', ()=>{
    survey.style.display='none'; captureWrap.style.display='block';
  });

  /**
   * 결과 캡처 → JPEG 다운로드 (iOS 사파리 폴백 포함)
   * - 하얀 캔버스에 '여백'을 더해 그려서 테두리가 꽉 차지 않음
   * - iOS에서 a[download] 불가시: 새 탭으로 열어 "길게 눌러 이미지 저장" 유도
   */
  const saveBtn = document.getElementById('saveJpegBtn');
  const hint = document.getElementById('saveHint');

  function isiOS(){
    return /iP(ad|hone|od)/.test(navigator.userAgent);
  }
  function timeStamp(){
    const d=new Date(); const p=n=>String(n).padStart(2,'0');
    return `${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}_${p(d.getHours())}${p(d.getMinutes())}`;
  }

  async function saveAsJpeg(){
    const target = document.getElementById('resultCard');

    // html2canvas 옵션: 스케일 높게, 배경 흰색
    const canvas = await html2canvas(target, {
      backgroundColor:'#ffffff',
      scale: window.devicePixelRatio > 1 ? 2 : 1.5,
      useCORS: true
    });

    // 여백(픽셀)
    const margin = 32; // ← 필요시 24~48로 조절
    const out = document.createElement('canvas');
    out.width  = canvas.width  + margin*2;
    out.height = canvas.height + margin*2;

    const ctx = out.getContext('2d');
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0,0,out.width,out.height);
    ctx.drawImage(canvas, margin, margin);

    // iOS에서 download 속성 동작 문제 대비: toBlob + 다운로드/폴백 처리
    out.toBlob(async (blob)=>{
      const fname = `career-result_${timeStamp()}.jpg`;

      // Web Share(이미지) 가능하면 우선 제공
      if (navigator.canShare && navigator.canShare({files:[new File([blob], fname, {type:'image/jpeg'})]})) {
        try{
          await navigator.share({ files:[new File([blob], fname, {type:'image/jpeg'})], title:'진로 결과 저장' });
          hint.textContent = '공유로 저장이 완료되었어요.';
          return;
        }catch(e){ /* 사용자가 취소한 경우 등은 무시 */ }
      }

      // 일반 다운로드 시도
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fname;

      // iOS 사파리 폴백: 새 탭으로 열기 (길게 눌러 저장)
      if (isiOS()) {
        window.open(url, '_blank');
        hint.textContent = '새 탭으로 이미지를 열었어요. 길게 눌러 "사진에 저장"을 선택하세요.';
        setTimeout(()=>URL.revokeObjectURL(url), 30000);
        return;
      }

      // 데스크톱/안드 안드로이드 등 대부분 브라우저
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      hint.textContent = 'JPEG 파일 다운로드를 시작했어요.';
    }, 'image/jpeg', 0.92);
  }

  saveBtn.addEventListener('click', ()=>{
    hint.textContent = '이미지를 준비 중…';
    saveAsJpeg().catch(()=>{
      hint.textContent = '저장이 실패했어요. 네트워크 상태를 확인한 후 다시 시도해주세요.';
    });
  });

  // 예시: 추천 진로 코드에 맞춰 이미지 경로 바꾸기 (실제 결과 계산 후 호출)
  function setCareerImageByCode(code){ // e.g. 'IA','IE','EC' ...
    const img = document.getElementById('careerImage');
    img.src = `assets/${code}.png`;
    img.onerror = ()=>{ img.src='assets/IA.png'; }; // 없으면 기본 이미지
  }
  // 데모용: 초기에 IA.png로 표시 (데스크톱/모바일 모두 노출됨)
  setCareerImageByCode('IA');
</script>
</body>
</html>
